---
import type { ImageMetadata } from 'astro'
import { Image } from 'astro:assets'

import type { iconsType } from 'astro-pure/types'
import { cn } from 'astro-pure/utils'

import { Button, Icon } from '../../../packages/pure/components/user'

interface Props {
  class?: string
  project: {
    image?: string
    name: string
    description: string
    collaborations?: boolean
    status?: string
    links?: {
      type: string
      href: string
    }[]
    skills?: string[]
  }[]
}
const { class: className, project, ...props } = Astro.props
const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/projects/*.{jpeg,jpg,png,gif,webp}'
)
const projectIconSet: Record<string, iconsType> = {
  github: 'github-circle',
  site: 'earth',
  doc: 'document',
  release: 'package',
  deprecated: 'alert'
}

const statusColorSet: Record<string, string> = {
  ongoing: 'bg-yellow-500/10 text-yellow-500',
  'en progreso': 'bg-yellow-500/10 text-yellow-500',
  completed: 'bg-green-500/10 text-green-500',
  completado: 'bg-green-500/10 text-green-500',
  archived: 'bg-red-500/10 text-red-500',
  archivado: 'bg-red-500/10 text-red-500'
}
---

<div class={className} {...props}>
  <div class='grid grid-cols-1 gap-x-4 gap-y-3 sm:grid-cols-2 sm:gap-y-4'>
    {
      project.map((project) => {
        var imagePath = null
        if (project.image) {
          imagePath = '/src/assets/projects/' + project.image
          if (!images[imagePath])
            throw new Error(
              `"${imagePath}" does not exist in glob: "src/assets/projects/*.{jpeg,jpg,png,gif,webp}"`
            )
        }

        return (
          <div class='relative overflow-hidden rounded-xl border'>
            {imagePath && (
              <Image
                class='absolute end-0 z-0 m-0 h-full w-1/2 object-cover opacity-40'
                src={images[imagePath]()}
                alt={project.name}
                loading='lazy'
                style={{
                  maskImage:
                    'linear-gradient(to right, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 1) 100%)',
                  msMaskImage:
                    '-ms-linear-gradient(to right, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 1) 100%)',
                  WebkitMaskImage:
                    '-webkit-linear-gradient(to right, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 1) 100%)'
                }}
              />
            )}

            <div
              class={cn(
                'relative z-10 flex flex-col gap-y-2 px-3 py-1.5 sm:px-4 sm:py-3',
                imagePath && 'me-20'
              )}
            >
              <div class='flex items-center justify-between gap-2'>
                <a
                  class='line-clamp-1 font-medium text-foreground no-underline transition-colors'
                  href={project.links?.[0]?.href || '#'}
                  target='_blank'
                >
                  {project.name}
                </a>
              </div>

              <div class='line-clamp-2 leading-snug text-muted-foreground sm:h-12'>
                {project.description}
              </div>
              <div class='flex flex-row items-center gap-x-2 sm:gap-x-1 flex-wrap'>
                {project.collaborations && (
                  <span class='text-xs px-3 rounded-full border border-dashed border-gray-400 hover:bg-muted transition-all whitespace-nowrap'>
                    Collaborative
                  </span>
                )}
                {project.status && (
                  <span
                    class={cn(
                      'text-xs px-3 rounded-full border border-dashed border-gray-400 hover:bg-muted transition-all whitespace-nowrap',
                      statusColorSet[project.status.toLowerCase()] ||
                        'bg-muted text-muted-foreground'
                    )}
                  >
                    {project.status}
                  </span>
                )}

                {project.links?.map((link) => {
                  const icon = projectIconSet[link.type]
                  return (
                    <a
                      href={link.href}
                      class='rounded-full bg-muted p-1 text-muted-foreground transition-colors sm:p-1.5'
                      aria-label={link.type}
                      target='_blank'
                    >
                      <Icon class='size-5' name={icon} />
                    </a>
                  )
                })}
              </div>

              <div class='flex flex-col gap-y-2 md:flex-row md:gap-x-5 md:gap-y-0'>
                {/* <h3 class='w-1/5 font-medium'>{title}</h3> */}
                <div class='flex  flex-row flex-wrap gap-x-1 gap-y-1 '>
                  {project.skills &&
                    project.skills.map((skill) => (
                      <Button class='' as='button' title={skill} style='pill' />
                    ))}
                </div>
              </div>
            </div>
          </div>
        )
      })
    }
  </div>
</div>
